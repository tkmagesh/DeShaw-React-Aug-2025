<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>State Manager</title>
    <script src="state-manager.js"></script>
    <script src="babel.min.js"></script>
    <script src="react.development.js"></script>
    <script src="react-dom.development.js"></script>
    <!-- 
    1. initial version
    2. Remove the direct dependency on the 'store' in the component
    3. Remove the responsibility of 'creating' actions from the component (introducing 'action creators')
    4. Delete the responsibility of 'dispatching actions' to 'action dispatchers'
    -->
    <script type="text/babel">
        function counterReducer(currentState = 0, action){
            if (action.type === 'INCREMENT') return currentState + 1;
            if (action.type === 'DECREMENT') return currentState - 1;
            return currentState;
        }
        
        

        const Counter = ({count, actionDispatchers}) => {
           
            const onBtnDecrementClick = () => {
                actionDispatchers.decrement() // => call the action creator, get the action object and dispatch the action
            }

            const onBtnIncrementClick = () => {
                actionDispatchers.increment()
            }

            return (
                <>
                    <h1>Counter</h1>
                    <hr/>
                    <button onClick={onBtnDecrementClick}>Decrement</button>
                    <span> {count} </span>
                    <button onClick={onBtnIncrementClick}>Increment</button>
                </>
            )
        }
        const counterActionCreators = {
            decrement(){
                const action = { type : 'DECREMENT' };
                return action; 
            },
            increment(){
                const action = { type : 'INCREMENT' };
                return action;
            }
        }

        function bindCounterActionCreators(counterActionCreators, dispatch){
            const actionDispatchers = {
                decrement(){
                    const action = counterActionCreators.decrement()
                    dispatch(action)
                },
                increment(){
                    const action = counterActionCreators.increment()
                    dispatch(action)
                }
            }
            return actionDispatchers;
        } 
        const store = StateManager.createStore(counterReducer)
        const counterActionDispatchers = bindCounterActionCreators(counterActionCreators, store.dispatch);

        const root = ReactDOM.createRoot(document.getElementById('root'));
        function renderApp(){
            const count = store.getState()
            root.render(<Counter 
                count={count} 
                actionDispatchers={counterActionDispatchers}
            />)
        }
        renderApp()
        store.subscribe(renderApp)
        
    </script>
</head>
<body>
    <div id="root"></div>
</body>
</html>